<html>
    <head>
        <script src="https://unpkg.com/msagl-js@latest/dist.min.js"></script>
        <script src="https://unpkg.com/@msagl/parser@latest/dist.min.js"></script>
        <script src="https://unpkg.com/@msagl/renderer@latest/dist.min.js"></script>
    </head>
    <script type="module">
        document.addEventListener("DOMContentLoaded", () => {
            const renderer = new msagl.RendererSvg();
            // handle rendering of dot sources
            window.addEventListener("message", (msg) => {
                const { type, lang, source, id } = ev.data;
                console.log(ev.data);
                if (type === "puppet" && lang == "msagl") {
                    const graph = msagl.parseDot(source);
                    renderer.setGraph(graph);
                    const svg = renderer.getSvgString();

                    console.log(`msagl ready`);
                    window.rise4funPostMessage?.({
                        id,
                        stdout: svg,
                    });
                }
            });

            // notify driver we are ready
            console.log(`msagl ready`);
            window.rise4funReady?.();
        });
    </script>
    <body></body>
</html>
